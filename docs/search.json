[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Work about the bathymetry estimation of Sainte Marie Lagoon?",
    "section": "",
    "text": "Visit the Github repository\n\n\n\n\n\n\n\n\n\n\nFigure 1: Map of the Bathymetry of the gulf od Sainte Marie\n\n\n\n\n\nBathymetry of Each Module\n\nlibrary(tidyverse)\nlibrary(terra)\nlibrary(sf)\nlibrary(ggiraph)\nlibrary(viridis)\nlibrary(mgcv)\n\nLe chargement a nécessité le package : nlme\n\n\n\nAttachement du package : 'nlme'\n\n\nL'objet suivant est masqué depuis 'package:dplyr':\n\n    collapse\n\n\nThis is mgcv 1.9-1. For overview type 'help(\"mgcv-package\")'.\n\nlibrary(tidyverse)\nlibrary(terra)\nlibrary(sf)\nlibrary(ggiraph)\nlibrary(viridis)\nlibrary(mgcv)\n\n# --- INPUTS ---\n# bathy : SpatRaster (0–30 m)\n# polys : sf with column \"ID\"\n\n# 0. Make valid + row index\npolys_valid &lt;- polys %&gt;%\n  st_make_valid() %&gt;%\n  mutate(poly_row = dplyr::row_number())\n\n# 1. Centroid latitude per polygon\npolys_cent &lt;- polys_valid %&gt;%\n  st_centroid(of_largest_polygon = TRUE) %&gt;%\n  mutate(\n    centroid_lat = st_coordinates(.)[, \"Y\"]\n  ) %&gt;%\n  st_drop_geometry() %&gt;%\n  select(poly_row, ID, centroid_lat)\n\nWarning: st_centroid assumes attributes are constant over geometries\n\n# 2. Extract raster values per polygon\ndf &lt;- bathy %&gt;%\n  terra::extract(vect(polys_valid), df = TRUE) %&gt;%\n  as_tibble() %&gt;%\n  rename(\n    poly_row = 1,\n    bathy    = 2\n  ) %&gt;%\n  left_join(polys_cent, by = \"poly_row\") %&gt;%\n  filter(!is.na(bathy))\n\n# 3. Per-ID stats (median + SD)\ndf_stats &lt;- df %&gt;%\n  group_by(ID, centroid_lat) %&gt;%\n  summarise(\n    median_bathy = median(bathy, na.rm = TRUE),\n    sd_bathy     = sd(bathy, na.rm = TRUE),\n    .groups      = \"drop\"\n  ) %&gt;%\n  mutate(\n    ymin = median_bathy - sd_bathy,\n    ymax = median_bathy + sd_bathy,\n    tooltip = paste0(\n      \"ID: \", ID, \"\\n\",\n      \"Latitude: \", round(centroid_lat, 4), \"°\\n\",\n      \"Median depth: \", round(median_bathy, 2), \" m\\n\",\n      \"SD: ±\", round(sd_bathy, 2), \" m\"\n    )\n  )\n\n# --- 4. GAM model & predictions (manual smooth + uncertainty) -------------\n\n# Fit GAM: median bathymetry ~ smooth(latitude)\ngam_fit &lt;- gam(\n  median_bathy ~ s(centroid_lat, k = 8),\n  data   = df_stats,\n  method = \"REML\"\n)\n\n# Prediction grid over latitude\nnew_lat &lt;- tibble(\n  centroid_lat = seq(\n    min(df_stats$centroid_lat, na.rm = TRUE),\n    max(df_stats$centroid_lat, na.rm = TRUE),\n    length.out = 200\n  )\n)\n\npred &lt;- predict(\n  gam_fit,\n  newdata = new_lat,\n  se.fit  = TRUE\n)\n\ngam_df &lt;- new_lat %&gt;%\n  mutate(\n    fit   = pred$fit,\n    se    = pred$se.fit,\n    lower = fit - 1.96 * se,\n    upper = fit + 1.96 * se\n  )\n\n# --- 5. Interactive plot --------------------------------------------------\n\np &lt;- ggplot() +\n  # SD whiskers (interactive)\n  geom_errorbar_interactive(\n    data = df_stats,\n    aes(\n      x     = centroid_lat,\n      ymin  = ymin,\n      ymax  = ymax,\n      data_id = ID,\n      tooltip = tooltip\n    ),\n    width = 0,\n    alpha = 0.5\n  ) +\n  # Median points (interactive)\n  geom_point_interactive(\n    data = df_stats,\n    aes(\n      x       = centroid_lat,\n      y       = median_bathy,\n      color   = centroid_lat,\n      data_id = ID,\n      tooltip = tooltip\n    ),\n    size = 3\n  ) +\n  # GAM uncertainty ribbon (static)\n  geom_ribbon(\n    data = gam_df,\n    aes(\n      x    = centroid_lat,\n      ymin = lower,\n      ymax = upper\n    ),\n    inherit.aes = FALSE,\n    alpha = 0.2\n  ) +\n  # GAM fitted line (static)\n  geom_line(\n    data = gam_df,\n    aes(\n      x = centroid_lat,\n      y = fit\n    ),\n    inherit.aes = FALSE,\n    linewidth = 1,\n    color = \"black\"\n  ) +\n  scale_color_viridis_c(name = \"Latitude\") +\n  labs(\n    x = \"Centroid latitude (°)\",\n    y = \"Median bathymetry (m)\",\n    title = \"Median bathymetry vs latitude with SD and GAM fit (95% CI)\"\n  ) +\n  theme_bw()\n\ng &lt;- girafe(\n  ggobj      = p,\n  width_svg  = 10,\n  height_svg = 6,\n  options = list(\n    opts_hover(css = \"stroke:black;stroke-width:2;\"),\n    opts_hover_inv(css = \"opacity:0.3;\"),\n    opts_toolbar(saveaspng = TRUE)\n  )\n)\n\ng"
  }
]